# Chapter 2 构建工具——CMAKE使用指南

## 简介

CMake是一个开源的C++构建工具，

原文地址：[Introduction · Modern CMake (modern-cmake-cn.github.io)](https://modern-cmake-cn.github.io/Modern-CMake-zh_CN/)

> ## CMAKE基础行为准则(应该避免此类行为)
>
> 1. **不要使用带有全局作用域的函数**，例如 `link_directories`、 `include_libraries` 等相似的函数。
> 2. **不要添加非必要的PUBLIC要求**：对于一些不必要的东西，应该将其声明为 `PRIVATE `而不是 `PUBLIC`
> 3. **不要在file函数中添加GLOB文件**： 如果不重新运行CMake，Make或者其他工具将不会知道你是否添加了某个文件。
> 4. **将库直接链接到需要构建的目标上**：如果可以的话，应该使用显式地链接到目标上
> 5. **当链接库文件时，不要省略PUBLIC或者PRIVATE关键字**：防止因为缺省导致后续所有链接都是缺省
>
> ## CMAKE应当遵守的规范
>
> 1. **把CMake程序视作代码**：应当是整洁并且可读的。
> 2. **建立目标的观念**
> 3. **应当使用接口进行导出**
> 4. **为库书写一个 `Config.cmake`文件**。这是库作者支持客户端体验而应该做的
> 5. **声明一个ALIAS目标以保持使用的一致性**：使用 `add_subdiractiory`和 `find_package`应该提供相同的目标和命名空间。
> 6. **将常见的功能合并到有详细文档的函数或者宏中**
> 7. **使用小写的函数名**:CMake 的函数和宏的名字可以定义为大写或小写，但是一般都使用小写，变量名用大写。
> 8. **使用 `cmake_policy` 和/或 限定版本号范围**

### 变量与缓存

#### 本地变量

声明本地变量：

```cmake
set(VARIABLE "value")
```

变量名通常使用大写。可以通过 `${}`来解析一个变量。CMake 有**作用域**的概念，在声明一个变量后，你只可以在它的作用域内访问这个变量。如果你将一个函数或一个文件放到一个子目录中，这个变量将不再被定义。

当然，还可以声明一个列表：

```cmake
set(LISTS "value1" "value2")
```

当然也可以通过 `;`进行分隔

```cmake
set(LISTS "value1;value2")
```

有一些和 `list(`进行协同的命令，`separate_arguments`可以把一个以空格分隔的字符串分隔成以列表。**值得注意的是，在CMake中如果一个值没有空格，那么加和不加引号的效果都是一样的**

> 当一个变量用 `${}` 括起来的时候，空格的解析规则和上述相同。对于路径来说要特别小心，路径很有可能会包含空格，因此你应该总是将解析变量得到的值用引号括起来，也就是，应该这样 `"${MY_PATH}"` 。

### 缓存变量

在CMake中提供了一个缓存变量来允许你在Command Line中对于该变量进行设置。如果一个变量还没有被定义，那么你可以使用以下的声明方法来设置：

```cmake
set(Cache_Value "VALUE" CACHE STRING "Description")
```
